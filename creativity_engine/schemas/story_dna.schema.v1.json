{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "keystone://creativity-engine/schema/story_dna.v1.json",
  "title": "Creativity Engine - STORY_DNA (v1)",
  "type": "object",
  "additionalProperties": false,
  "required": ["schema_version", "story_id", "seed", "knobs", "layers"],
  "properties": {
    "schema_version": { "type": "string", "const": "story_dna.v1" },
    "story_id": { "type": "string", "format": "uuid" },
    "seed": { "type": "integer", "minimum": 0 },
    "knobs": { "$ref": "#/$defs/Knobs" },
    "tags": {
      "type": "array",
      "items": { "type": "string", "minLength": 1, "maxLength": 64 },
      "maxItems": 40
    },
    "layers": { "$ref": "#/$defs/Layers" }
  },
  "$defs": {
    "Knobs": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "randomness",
        "continuity_strictness",
        "depth_bias",
        "twist_probability",
        "conflict_ratio"
      ],
      "properties": {
        "randomness": { "type": "number", "minimum": 0.0, "maximum": 1.0 },
        "continuity_strictness": { "type": "number", "minimum": 0.0, "maximum": 1.0 },
        "depth_bias": { "type": "number", "minimum": 0.0, "maximum": 1.0 },
        "twist_probability": { "type": "number", "minimum": 0.0, "maximum": 1.0 },
        "conflict_ratio": { "type": "number", "minimum": 0.0, "maximum": 1.0 }
      }
    },

    "Layers": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "structural_engine",
        "psychological_hook",
        "identity_spine",
        "thematic_axis",
        "escalation_model",
        "relational_map",
        "immersion_profile"
      ],
      "properties": {
        "structural_engine": { "$ref": "#/$defs/StructuralEngine" },
        "psychological_hook": { "$ref": "#/$defs/PsychologicalHook" },
        "identity_spine": { "$ref": "#/$defs/IdentitySpine" },
        "thematic_axis": { "$ref": "#/$defs/ThematicAxis" },
        "escalation_model": { "$ref": "#/$defs/EscalationModel" },
        "relational_map": { "$ref": "#/$defs/RelationalMap" },
        "immersion_profile": { "$ref": "#/$defs/ImmersionProfile" },
        "meta_amplification": { "$ref": "#/$defs/MetaAmplification" }
      }
    },

    "StructuralEngine": {
      "type": "object",
      "additionalProperties": false,
      "required": ["story_type", "pov", "tense", "tone", "length_target", "act_count"],
      "properties": {
        "story_type": {
          "type": "string",
          "enum": [
            "choose_your_own_adventure",
            "linear_short",
            "linear_long",
            "episodic_serial",
            "mystery_case",
            "romance_arc",
            "hero_journey",
            "slice_of_life"
          ]
        },
        "pov": { "type": "string", "enum": ["first", "third_limited", "third_omniscient"] },
        "tense": { "type": "string", "enum": ["past", "present"] },
        "tone": { "type": "string", "minLength": 1, "maxLength": 80 },
        "genre": { "type": "string", "minLength": 1, "maxLength": 80 },
        "length_target": { "type": "string", "enum": ["micro", "short", "novella", "novel"] },
        "act_count": { "type": "integer", "minimum": 1, "maximum": 7 }
      }
    },

    "PsychologicalHook": {
      "type": "object",
      "additionalProperties": false,
      "required": ["curiosity_question", "emotional_hook", "opening_promise"],
      "properties": {
        "curiosity_question": { "type": "string", "minLength": 8, "maxLength": 240 },
        "emotional_hook": { "type": "string", "minLength": 8, "maxLength": 240 },
        "opening_promise": { "type": "string", "minLength": 8, "maxLength": 240 }
      }
    },

    "IdentitySpine": {
      "type": "object",
      "additionalProperties": false,
      "required": ["protagonist", "core_lie", "core_need", "core_want", "transformation_goal"],
      "properties": {
        "protagonist": { "$ref": "#/$defs/CharacterSeed" },
        "core_lie": { "type": "string", "minLength": 6, "maxLength": 240 },
        "core_need": { "type": "string", "minLength": 6, "maxLength": 240 },
        "core_want": { "type": "string", "minLength": 6, "maxLength": 240 },
        "transformation_goal": { "type": "string", "minLength": 6, "maxLength": 240 }
      }
    },

    "ThematicAxis": {
      "type": "object",
      "additionalProperties": false,
      "required": ["thematic_question", "values_in_conflict", "climax_choice_resolves_tension"],
      "properties": {
        "thematic_question": { "type": "string", "minLength": 8, "maxLength": 240 },
        "values_in_conflict": {
          "type": "array",
          "minItems": 2,
          "maxItems": 6,
          "items": { "type": "string", "minLength": 3, "maxLength": 64 }
        },
        "climax_choice_resolves_tension": { "type": "boolean" }
      }
    },

    "EscalationModel": {
      "type": "object",
      "additionalProperties": false,
      "required": ["stakes_curve", "danger_curve", "intimacy_curve", "pivot_rules"],
      "properties": {
        "stakes_curve": { "$ref": "#/$defs/Curve" },
        "danger_curve": { "$ref": "#/$defs/Curve" },
        "intimacy_curve": { "$ref": "#/$defs/Curve" },
        "pivot_rules": {
          "type": "object",
          "additionalProperties": false,
          "required": ["max_pivots", "pivot_requires_setup", "setup_call_back_required"],
          "properties": {
            "max_pivots": { "type": "integer", "minimum": 0, "maximum": 10 },
            "pivot_requires_setup": { "type": "boolean" },
            "setup_call_back_required": { "type": "boolean" }
          }
        }
      }
    },

    "RelationalMap": {
      "type": "object",
      "additionalProperties": false,
      "required": ["supporting_cast", "relationships"],
      "properties": {
        "supporting_cast": {
          "type": "array",
          "maxItems": 24,
          "items": { "$ref": "#/$defs/CharacterSeed" }
        },
        "relationships": {
          "type": "array",
          "maxItems": 64,
          "items": { "$ref": "#/$defs/RelationshipEdge" }
        }
      }
    },

    "ImmersionProfile": {
      "type": "object",
      "additionalProperties": false,
      "required": ["setting", "sensory_focus", "style_constraints"],
      "properties": {
        "setting": { "$ref": "#/$defs/SettingSeed" },
        "sensory_focus": {
          "type": "array",
          "minItems": 1,
          "maxItems": 6,
          "items": { "type": "string", "enum": ["sight", "sound", "smell", "touch", "taste", "interoception"] }
        },
        "style_constraints": {
          "type": "object",
          "additionalProperties": false,
          "required": ["reading_level", "humor_level", "violence_level", "romance_level"],
          "properties": {
            "reading_level": { "type": "string", "enum": ["kids", "ya", "adult", "literary"] },
            "humor_level": { "type": "integer", "minimum": 0, "maximum": 10 },
            "violence_level": { "type": "integer", "minimum": 0, "maximum": 10 },
            "romance_level": { "type": "integer", "minimum": 0, "maximum": 10 }
          }
        }
      }
    },

    "MetaAmplification": {
      "type": "object",
      "additionalProperties": false,
      "required": ["enabled", "techniques"],
      "properties": {
        "enabled": { "type": "boolean" },
        "techniques": {
          "type": "array",
          "maxItems": 10,
          "items": {
            "type": "string",
            "enum": [
              "foreshadowing",
              "motif_echo",
              "misdirection",
              "dramatic_irony",
              "mystery_box",
              "emotional_callback",
              "symbolic_object"
            ]
          }
        }
      }
    },

    "Curve": {
      "type": "object",
      "additionalProperties": false,
      "required": ["start", "mid", "end"],
      "properties": {
        "start": { "type": "integer", "minimum": 0, "maximum": 100 },
        "mid": { "type": "integer", "minimum": 0, "maximum": 100 },
        "end": { "type": "integer", "minimum": 0, "maximum": 100 }
      }
    },

    "CharacterSeed": {
      "type": "object",
      "additionalProperties": false,
      "required": ["name", "role", "traits", "motivation"],
      "properties": {
        "name": { "type": "string", "minLength": 1, "maxLength": 80 },
        "role": { "type": "string", "minLength": 1, "maxLength": 80 },
        "traits": {
          "type": "array",
          "minItems": 2,
          "maxItems": 10,
          "items": { "type": "string", "minLength": 2, "maxLength": 50 }
        },
        "motivation": { "type": "string", "minLength": 6, "maxLength": 240 },
        "backstory_hint": { "type": "string", "maxLength": 400 }
      }
    },

    "RelationshipEdge": {
      "type": "object",
      "additionalProperties": false,
      "required": ["a", "b", "type", "tension"],
      "properties": {
        "a": { "type": "string", "minLength": 1, "maxLength": 80 },
        "b": { "type": "string", "minLength": 1, "maxLength": 80 },
        "type": {
          "type": "string",
          "enum": ["ally", "enemy", "mentor", "family", "romantic", "rival", "stranger", "betrayer"]
        },
        "tension": { "type": "integer", "minimum": 0, "maximum": 100 },
        "notes": { "type": "string", "maxLength": 300 }
      }
    },

    "SettingSeed": {
      "type": "object",
      "additionalProperties": false,
      "required": ["name", "timeframe", "place", "rules"],
      "properties": {
        "name": { "type": "string", "minLength": 1, "maxLength": 120 },
        "timeframe": { "type": "string", "minLength": 1, "maxLength": 120 },
        "place": { "type": "string", "minLength": 1, "maxLength": 240 },
        "rules": {
          "type": "array",
          "minItems": 1,
          "maxItems": 12,
          "items": { "type": "string", "minLength": 4, "maxLength": 140 }
        }
      }
    }
  }
}